bunx lint-staged

# Get all staged .mdx files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=d | grep "^src/content/blog/.*\.mdx$" || true)

if [ -z "$STAGED_FILES" ]; then
    echo "No staged .mdx files found. Skipping encryption."
    exit 0
fi

echo "Encrypting staged .mdx files..."

# Encrypt all files in one command
bun run contents:encrypt $STAGED_FILES

# Stage the encrypted files and unstage the plaintext files
while IFS= read -r FILE; do
    BASENAME=${FILE##*/}
    OUTPUT_FILE="src/content/blog/artifacts/${BASENAME}.gpg"
    git add "$OUTPUT_FILE"
    git restore --staged "$FILE"
done <<< "$STAGED_FILES"

echo "Encryption complete. Staged encrypted files."

exit 0
