bunx lint-staged

STAGED_FILES=$(git diff --cached --name-only --diff-filter=d | grep "^src/content/blog/.*\.mdx$")


if [ -z "$STAGED_FILES" ]; then
    echo "No staged .mdx files found. Skipping encryption."
    exit 0
fi

echo "Encrypting staged .mdx files..."
for FILE in $STAGED_FILES; do
    OUTPUT_FILE="${FILE%.mdx}.mdx.gpg"
    echo "Encrypting $FILE to $OUTPUT_FILE..."
    bun run contents:encrypt "$FILE"

    # Step 3: Stage the encrypted file and unstage the plaintext file
    git add "$OUTPUT_FILE"
    git restore --staged "$FILE"
done

echo "Encryption complete. Staged encrypted files."

exit 0
